<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Parcel Checkpoint - Post Office Management</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0,0" rel="stylesheet" />
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
      min-height: 100vh;
      line-height: 1.6;
      color: #2f3640;
      padding: 15px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    
    .page-header {
      background: linear-gradient(135deg, #ffffff 0%, #f8f9fb 100%);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 25px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      text-align: center;
      border: 2px solid rgba(255,255,255,0.9);
      position: relative;
      overflow: hidden;
    }
    
    .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
      background-size: 300% 100%;
      animation: gradientShift 3s ease infinite;
    }
    
    @keyframes gradientShift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    
    .page-header h1 {
      color: #2f3640;
      font-weight: 700;
      margin-bottom: 10px;
      font-size: 2rem;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .parcel-id {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 8px 20px;
      border-radius: 25px;
      font-size: 1.1rem;
      font-weight: 600;
      display: inline-block;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
    }
    
    .alert-custom {
      border-radius: 15px;
      border: none;
      padding: 20px;
      margin-bottom: 25px;
      font-weight: 500;
      box-shadow: 0 5px 20px rgba(0,0,0,0.1);
      position: relative;
      overflow: hidden;
    }
    
    .alert-custom::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: currentColor;
      opacity: 0.7;
    }
    
    .alert-success {
      background: linear-gradient(135deg, #2ed573 0%, #17c0eb 100%);
      color: white;
    }
    
    .alert-danger {
      background: linear-gradient(135deg, #ff4757 0%, #ff3838 100%);
      color: white;
    }
    
    .card-custom {
      background: linear-gradient(135deg, #ffffff 0%, #fafbfc 100%);
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.15);
      border: 2px solid rgba(255,255,255,0.9);
      margin-bottom: 25px;
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      position: relative;
    }
    
    .card-custom:hover {
      transform: translateY(-5px);
      box-shadow: 0 25px 50px rgba(0,0,0,0.25);
    }
    
    .card-header-custom {
      background: linear-gradient(135deg, #4c63d2 0%, #5a4fcf 100%);
      color: white;
      padding: 25px;
      font-weight: 600;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      position: relative;
      overflow: hidden;
      border-bottom: 3px solid rgba(255,255,255,0.2);
    }
    
    .card-header-custom::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1));
      transform: skewX(-20deg);
    }
    
    .card-header-custom i {
      margin-right: 12px;
      font-size: 24px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
    }
    
    .card-body-custom {
      padding: 30px;
    }
    
    .status-badge {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 30px;
      font-size: 0.9rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: transform 0.3s ease;
    }
    
    .status-badge:hover {
      transform: scale(1.05);
    }
    
    .status-REGISTERED { 
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); 
      color: white; 
    }
    .status-AT_ORIGIN_POST_OFFICE { 
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); 
      color: white; 
    }
    .status-IN_TRANSIT { 
      background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%); 
      color: white; 
    }
    .status-AT_DESTINATION_POST_OFFICE { 
      background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); 
      color: white; 
    }
    .status-OUT_FOR_DELIVERY { 
      background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); 
      color: white; 
    }
    .status-DELIVERED { 
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%); 
      color: white; 
    }
    .status-DELIVERY_ATTEMPT_FAILED { 
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); 
      color: white; 
    }
    .status-RETURNED_TO_ORIGIN { 
      background: linear-gradient(135deg, #e91e63 0%, #ad1457 100%); 
      color: white; 
    }
    .status-ON_HOLD { 
      background: linear-gradient(135deg, #ff9800 0%, #f57c00 100%); 
      color: white; 
    }
    
    .info-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .info-table tr {
      border-bottom: 2px solid #f8f9fa;
      transition: background-color 0.3s ease;
    }
    
    .info-table tr:hover {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .info-table tr:last-child {
      border-bottom: none;
    }
    
    .info-table td {
      padding: 15px 0;
      vertical-align: top;
    }
    
    .info-label {
      font-weight: 600;
      color: #667eea;
      width: 35%;
      font-size: 0.95rem;
    }
    
    .info-value {
      color: #2f3640;
      font-weight: 500;
      font-size: 1rem;
    }
    
    .form-section {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 15px;
      padding: 30px;
      border: 2px solid #dee2e6;
      position: relative;
      overflow: hidden;
    }
    
    .form-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, #667eea, #764ba2);
    }
    
    .form-label {
      font-weight: 600;
      color: #2f3640;
      margin-bottom: 8px;
      font-size: 0.95rem;
    }
    
    .form-control, .form-select {
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 15px 18px;
      font-size: 0.95rem;
      transition: all 0.3s ease;
      background: white;
    }
    
    .form-control:focus, .form-select:focus {
      border-color: #667eea;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
      outline: none;
      transform: translateY(-1px);
    }
    
    .btn-primary-custom {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border: none;
      border-radius: 12px;
      padding: 15px 35px;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .btn-primary-custom:hover {
      background: linear-gradient(135deg, #5a6fd8 0%, #6a4190 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    }
    
    .btn-secondary-custom {
      background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      border: none;
      border-radius: 12px;
      padding: 15px 35px;
      font-weight: 600;
      color: white;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(116, 185, 255, 0.3);
    }
    
    .btn-secondary-custom:hover {
      background: linear-gradient(135deg, #5faeff 0%, #0770c1 100%);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(116, 185, 255, 0.4);
    }
    
    .history-timeline {
      position: relative;
    }
    
    .history-item {
      position: relative;
      padding: 25px 0 25px 50px;
      border-left: 3px solid #e9ecef;
      margin-left: 20px;
      transition: all 0.3s ease;
    }
    
    .history-item:hover {
      border-left-color: #667eea;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 0 10px 10px 0;
      padding-right: 15px;
    }
    
    .history-item:last-child {
      border-left: 3px solid transparent;
    }
    
    .history-item::before {
      content: '';
      position: absolute;
      left: -9px;
      top: 30px;
      width: 15px;
      height: 15px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 0 3px #e9ecef, 0 3px 10px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }
    
    .history-item:hover::before {
      transform: scale(1.2);
      box-shadow: 0 0 0 3px #667eea, 0 5px 15px rgba(102, 126, 234, 0.3);
    }
    
    .history-status {
      font-weight: 700;
      color: #2f3640;
      margin-bottom: 10px;
      font-size: 1.1rem;
    }
    
    .history-meta {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 20px;
      color: #667eea;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .history-meta span {
      display: block;
    }
    
    .history-remarks {
      margin-top: 15px;
      padding: 15px 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: 10px;
      font-style: italic;
      color: #57606f;
      border-left: 4px solid #667eea;
    }
    
    .empty-state {
      text-align: center;
      padding: 50px 20px;
      color: #a4b0be;
    }
    
    .empty-state i {
      font-size: 64px;
      margin-bottom: 20px;
      opacity: 0.5;
      color: #667eea;
    }
    
    .d-flex-gap {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-top: 30px;
      flex-wrap: wrap;
    }
    
    .cards-row {
      display: flex;
      gap: 25px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .card-half {
      flex: 1;
      min-width: 300px;
    }
    
    /* Enhanced Responsiveness */
    @media (max-width: 1200px) {
      .container {
        max-width: 100%;
        padding: 0 20px;
      }
    }
    
    @media (max-width: 992px) {
      .page-header h1 {
        font-size: 1.7rem;
      }
      
      .card-header-custom {
        padding: 20px;
        font-size: 1.1rem;
      }
      
      .card-body-custom {
        padding: 25px;
      }
    }
    
    @media (max-width: 768px) {
      body {
        padding: 10px;
      }
      
      .container {
        padding: 0 10px;
      }
      
      .page-header {
        padding: 25px 20px;
        margin-bottom: 20px;
      }
      
      .page-header h1 {
        font-size: 1.5rem;
      }
      
      .parcel-id {
        font-size: 1rem;
        padding: 6px 16px;
      }
      
      .card-header-custom {
        padding: 18px;
        font-size: 1rem;
      }
      
      .card-body-custom {
        padding: 20px;
      }
      
      .info-table td {
        padding: 12px 0;
      }
      
      .info-label {
        width: 40%;
        font-size: 0.9rem;
      }
      
      .info-value {
        font-size: 0.95rem;
      }
      
      .form-section {
        padding: 25px 20px;
      }
      
      .d-flex-gap {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
      }
      
      .cards-row {
        flex-direction: column;
        gap: 20px;
      }
      
      .card-half {
        min-width: auto;
      }
      
      .btn-primary-custom, .btn-secondary-custom {
        width: 100%;
        text-align: center;
        padding: 12px 25px;
      }
      
      .history-item {
        padding: 20px 0 20px 40px;
        margin-left: 15px;
      }
      
      .history-meta {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }
    
    @media (max-width: 576px) {
      .page-header h1 {
        font-size: 1.3rem;
      }
      
      .card-header-custom i {
        font-size: 20px;
        margin-right: 8px;
      }
      
      .status-badge {
        padding: 10px 20px;
        font-size: 0.8rem;
      }
      
      .info-table td {
        padding: 10px 0;
        display: block;
        width: 100%;
      }
      
      .info-label {
        width: 100%;
        margin-bottom: 5px;
        font-weight: 700;
        color: #2f3640;
      }
      
      .info-value {
        margin-left: 10px;
        color: #667eea;
      }
      
      .history-item {
        padding: 18px 0 18px 35px;
        margin-left: 12px;
      }
      
      .form-control, .form-select {
        padding: 12px 15px;
      }
    }
    
    @media (max-width: 400px) {
      .page-header {
        padding: 20px 15px;
      }
      
      .card-body-custom {
        padding: 15px;
      }
      
      .form-section {
        padding: 20px 15px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Page Header -->
    <div class="page-header">
      <h1><i class="material-symbols-rounded" style="vertical-align: middle; margin-right: 10px;">qr_code_scanner</i>Parcel Checkpoint</h1>
      <div th:if="${parcel}" class="parcel-id" th:text="${'Parcel ID: ' + parcel.parcelId}">Parcel ID: PCL12345</div>
    </div>
    
    <!-- Error Message -->
    <div th:if="${error}" class="alert alert-danger alert-custom">
      <i class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">error</i>
      <span th:text="${error}">Error message</span>
      <div style="margin-top: 15px;">
        <a href="/parcel/view" class="btn-primary-custom">Go to Parcel Management</a>
      </div>
    </div>
    
    <!-- Success Message -->
    <div th:if="${success}" class="alert alert-success alert-custom">
      <i class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">check_circle</i>
      <span th:text="${success}">Status updated successfully</span>
    </div>
    
    <!-- Main Content -->
    <div th:if="${parcel}">
      <!-- Parcel Information and Update Status Cards (Side by Side) -->
      <div class="cards-row">
        <!-- Parcel Information Card -->
        <div class="card-custom card-half">
          <div class="card-header-custom">
            <i class="material-symbols-rounded">package_2</i>
            Parcel Information
          </div>
          <div class="card-body-custom">
            <!-- Current Status Display -->
            <div style="text-align: center; margin-bottom: 25px; padding-bottom: 20px; border-bottom: 2px solid #f1f2f6;">
              <label class="form-label" style="display: block; margin-bottom: 10px; font-size: 0.9rem; color: #57606f; font-weight: 600;">Current Status:</label>
              <div class="status-badge" 
                   th:classappend="${'status-' + parcel.current_status}" 
                   th:text="${#strings.replace(parcel.current_status, '_', ' ')}"
                   style="margin-bottom: 0;">
                Current Status
              </div>
            </div>
            
            <table class="info-table">
              <tr>
                <td class="info-label">Sender:</td>
                <td class="info-value" th:text="${parcel.senderName}">John Doe</td>
              </tr>
              <tr>
                <td class="info-label">Receiver:</td>
                <td class="info-value" th:text="${parcel.receiverName}">Jane Smith</td>
              </tr>
              <tr>
                <td class="info-label">Receiver Address:</td>
                <td class="info-value" th:text="${parcel.receiverAddress}">456 Oak Ave</td>
              </tr>
              <tr>
                <td class="info-label">Weight:</td>
                <td class="info-value" th:text="${parcel.weight + ' kg'}">2.5 kg</td>
              </tr>
              <tr>
                <td class="info-label">Category:</td>
                <td class="info-value" th:text="${parcel.category}">PACKAGE</td>
              </tr>
              <tr>
                <td class="info-label">Assigned Office:</td>
                <td class="info-value" th:text="${parcel.assignedOffice != null ? parcel.assignedOffice.officeName : 'Not Assigned'}">Main Office</td>
              </tr>
            </table>
          </div>
        </div>
        
        <!-- Update Status Card -->
        <div class="card-custom card-half">
          <div class="card-header-custom">
            <i class="material-symbols-rounded">update</i>
            Update Parcel Status
          </div>
          <div class="card-body-custom">
            <div class="form-section">
              <form th:action="@{/qr/checkpoint/update-status}" method="post">
                <input type="hidden" name="parcelId" th:value="${parcel.parcelId}">
                
                <div class="row mb-3">
                  <div class="col-md-12 mb-3">
                    <label for="status" class="form-label">New Status</label>
                    <select class="form-select" id="status" name="status" required>
                      <option value="">Select Status</option>
                      <option value="REGISTERED">Registered</option>
                      <option value="AT_ORIGIN_POST_OFFICE">At Origin Post Office</option>
                      <option value="IN_TRANSIT">In Transit</option>
                      <option value="AT_DESTINATION_POST_OFFICE">At Destination Post Office</option>
                      <option value="OUT_FOR_DELIVERY">Out for Delivery</option>
                      <option value="DELIVERED">Delivered</option>
                      <option value="DELIVERY_ATTEMPT_FAILED">Delivery Attempt Failed</option>
                      <option value="RETURNED_TO_ORIGIN">Returned to Origin</option>
                      <option value="ON_HOLD">On Hold</option>
                    </select>
                  </div>
                  
                  <div class="col-md-12 mb-3">
                    <label for="location" class="form-label">Current Location</label>
                    <input type="text" class="form-control" id="location" name="location" 
                           placeholder="Enter current location">
                  </div>
                </div>
                
                <div class="mb-3">
                  <label for="notes" class="form-label">Notes (Optional)</label>
                  <textarea class="form-control" id="notes" name="notes" rows="3" 
                           placeholder="Enter any additional notes..."></textarea>
                </div>
                
                <div class="d-flex-gap">
                  <button type="submit" class="btn-primary-custom">
                    <i class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">update</i>
                    Update Status
                  </button>
                  
                  <a href="/parcel/view" class="btn-secondary-custom">
                    <i class="material-symbols-rounded" style="vertical-align: middle; margin-right: 8px;">arrow_back</i>
                    Back to Parcels
                  </a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Parcel History Card -->
      <div th:if="${parcel != null and parcel.history != null}" class="card-custom">
        <div class="card-header-custom">
          <i class="material-symbols-rounded">history</i>
          Parcel History
        </div>
        <div class="card-body-custom">
          <div th:if="${parcel.history != null and not #lists.isEmpty(parcel.history)}" class="history-timeline">
            <div th:each="history : ${parcel.history}" class="history-item">
              <div class="history-status" th:text="${#strings.replace(history.status, '_', ' ')}">Status Update</div>
              <div class="history-meta">
                <span><strong>Time:</strong> <span th:text="${#temporals.format(history.updateTime, 'MMM dd, yyyy HH:mm')}">Dec 01, 2024 10:30</span></span>
                <span><strong>Location:</strong> <span th:text="${history.location}">Main Office</span></span>
              </div>
              <div th:if="${history.remarks}" class="history-remarks" th:text="${history.remarks}">Status updated</div>
            </div>
          </div>
          
          <div th:if="${parcel.history == null or #lists.isEmpty(parcel.history)}" class="empty-state">
            <i class="material-symbols-rounded">history_off</i>
            <p>No history records found for this parcel</p>
          </div>
        </div>
      </div>
    </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
